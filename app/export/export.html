<!-- /*
* START Francis Nash Jasmin 2022/05/11
* 
* Changed layout of export page and added new dropdown filters.
* 
*/ -->
<label>No. of Deals to be Exported: <u>{{ dealCount }}</u></label>
<div class="row">
    <div class="col-md-12 form-inline">
        <form name="viewSelect">
            <button class="btn btn-success" ng-click="exportData()">Export Deals</button>
            |
            <label>Division:</label>
            <select class="form-control input-sm" name="Division" ng-model="divisionOption" ng-change="filterDeals()">
                <option value="">- ALL -</option>
                <option ng-repeat="division in divisions">{{division}}</option>
            </select>
            &nbsp;
            &nbsp;
            <label>SD:</label>
            <ng-dropdown-multiselect options="sd" selected-model="sdOption" events="filterDeals()" translation-texts="{ buttonDefaultText: 'Select SDs' }" checkboxes="true" extra-settings="myDropdownSettings"></ng-dropdown-multiselect>
            &nbsp;
            &nbsp;
            <label>BU Dev:</label>
            <ng-dropdown-multiselect options="devBU" selected-model="buDevOption" events="filterDeals()" translation-texts="{ buttonDefaultText: 'Select BUs' }" checkboxes="true" extra-settings="myDropdownSettings"></ng-dropdown-multiselect>
            &nbsp;
            &nbsp;
            <label>Search by Column: </label>
            <select ng-model="searchColumn" class="form-control input-sm">
                <option value="all,$"> -- ALL -- </option>
                <!-- /*
                * START Francis Nash Jasmin 2022/02/28
                * 
                * Fixed entries to be displayed in search by column dropdown.
                * 
                */ -->
                <option ng-repeat="essentialField in fields.essential" 
                    ng-if="essentialField.showInList"
                    value="{{'essential,' + essentialField.name}}">
                    {{ (renamedFields['essential'][essentialField.name] ? renamedFields['essential'][essentialField.name] : essentialField.name) }}
                </option>
                <option ng-repeat="profileField in fields.profile" 
                    ng-if="profileField.showInList && 
                    profileField.name !== 'Resource Size (MM)' && 
                    profileField.name !== 'Resource Size (FTE)' &&
                    profileField.name !== 'Revenue' &&
                    profileField.name !== 'CM'" 
                    value="{{'profile,' + profileField.name}}">
                    {{ (renamedFields['profile'][profileField.name] ? renamedFields['profile'][profileField.name] : profileField.name) }}
                </option>
                <!-- /*  END Francis Nash Jasmin 2022/02/28 */ -->
            </select>
            <input type="text" class="form-control" ng-model="searchText" ng-change="filterDeals()" placeholder="Search">
        </form>
    </div>
    <br />
    <br />
    <div class="col-md-12 form-inline">
        <form name="dateSelect">
            <!-- Pass the dates entered to the part where generateMonths function is found. -->
            <div class="form-inline">
                <h5>Display Dates for Resources, Revenue, and CM</h5>
                <label>Start Date</label>
                <div class="input-group">
                    <input type="text" name="Start Date" uib-datepicker-popup="{{DATE_FORMAT}}" is-open="opened['Start Date']"
                        class="form-control input-sm" ng-model="enteredStartDate"
                        uib-tooltip="{{getTooltipMessage(dateSelect['Start Date'])}}" tooltip-enable="{{dateSelect['Start Date'].$invalid}}"
                        placeholder="{{DATE_FORMAT | uppercase }}">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-sm" ng-click="opened['Start Date'] = true">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </button>
                    </span>
                </div>
                &nbsp;
                &nbsp;
                <label>End Date</label>
                <div class="input-group">
                    <input type="text" name="End Date" uib-datepicker-popup="{{DATE_FORMAT}}" is-open="opened['End Date']"
                        class="form-control input-sm" ng-model="enteredEndDate"
                        uib-tooltip="{{getTooltipMessage(dateSelect['End Date'])}}" tooltip-enable="{{dateSelect['End Date'].$invalid}}"
                        placeholder="{{DATE_FORMAT | uppercase }}">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-sm" ng-click="opened['End Date'] = true">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </button>
                    </span>
                </div>
                &nbsp;
                <button class="btn btn-primary" ng-click="setDates(enteredStartDate, enteredEndDate)" ng-disabled="enteredStartDate === ''">Enter Dates</button>
                &nbsp;
                &nbsp;
                <div style="float: right;">
                    <label style="text-shadow: 1px 1px 0px  #fff, -1px -1px 0px  #fff, 1px -1px 0px  #fff, -1px 1px 0px  #fff" for="pageSize">Preview page size: </label>
                    <input id="pageSize" type="number" ng-model="pageSize" class="form-control" min="1" max={{deals.length}}
                    onkeypress="return event.charCode >= 48 && event.charCode <= 57"> 
                </div>
            </div>
            
        </form>
    </div>
</div>
<!-- /*  END Francis Nash Jasmin 2022/05/16 */ -->
<br />
<div class="row">
    <div class="col-md-12 table-responsive alternateView">
        <div style="text-align:center" class="spinner" ng-show="loading">
            <img src="loader.gif" />
        </div>
        <div id="altView">
            <table class="table table-hover compact dealTable normal-table table-striped">
                <thead id="header-fixed">
                    <tr>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>DocNumber</b>
                                <div ng-click="sortColumn('essential', 'ID')" ng-class="sortClass('essential', 'ID')" />
                            </div>
                        </th>
                        <!-- Customer -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>Customer</b>
                                <div ng-click="sortColumn('profile', 'Client')" ng-class="sortClass('profile', 'Client')" />
                            </div>
                        </th>
                        <!-- Subject -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>Subject</b>
                                <div ng-click="sortColumn('essential', 'Deal Name')" ng-class="sortClass('essential', 'Deal Name')" />
                            </div>
                        </th>
                        <!-- Level -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>Level</b>
                                <div ng-click="sortColumn('profile', 'Level')" ng-class="sortClass('profile', 'Level')" />
                            </div>
                        </th>
                        <!-- Step (JA) -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>Step</b>
                                <div ng-click="sortColumn('profile', 'Step')" ng-class="sortClass('profile', 'Step')" />
                            </div>
                        </th>
                        <!-- ServiceType -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>ServiceType</b>
                                <div ng-click="sortColumn('profile', 'Type')" ng-class="sortClass('profile', 'Type')" />
                            </div>
                        </th>
                        <!-- RespSales -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>RespSales</b>
                                <div ng-click="sortColumn('profile', 'AWS Resp (Sales) person')" ng-class="sortClass('profile', 'AWS Resp (Sales) person')" />
                            </div>
                        </th>
                        <!-- RespDev -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>RespDev</b>
                                <div ng-click="sortColumn('profile', 'AWS Resp (Dev) person')" ng-class="sortClass('profile', 'AWS Resp (Dev) person')" />
                            </div>
                        </th>
                        <!-- StartDate -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>StartDate</b>
                                <div ng-click="sortColumn('profile', 'Duration (Start)')" ng-class="sortClass('profile', 'Duration (Start)')" />
                            </div>
                        </th>
                        <!-- EndDate -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>EndDate</b>
                                <div ng-click="sortColumn('profile', 'Duration (End)')" ng-class="sortClass('profile', 'Duration (End)')" />
                            </div>
                        </th>
                        <!-- DueDate -->
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>DueDate</b>
                                <div ng-click="sortColumn('essential', 'Due Date')" ng-class="sortClass('essential', 'Due Date')" />
                            </div>
                        </th>

                        <th data-a-h="right" style="text-align:right" class="tContents" ng-repeat="month in generateMonths(startDate, endDate)">
                            <div class="tHeaders inline">
                                {{ formatMonthHeader(month) }}
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                RMM Total
                            </div>
                        </th>

                        <th data-a-h="right" style="text-align:right" class="tContents" ng-repeat="month in generateMonths(startDate, endDate)">
                            <div class="tHeaders inline">
                                {{ formatMonthHeader(month) }}
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                Revenue Total
                            </div>
                        </th>

                        <th data-a-h="right" style="text-align:right" class="tContents" ng-repeat="month in generateMonths(startDate, endDate)">
                            <div class="tHeaders inline">
                                {{ formatMonthHeader(month) }}
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                CM Total
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>BU Sales</b>
                                <div ng-click="sortColumn('profile', 'AWS Resp (Sales) BU')" ng-class="sortClass('profile', 'AWS Resp (Sales) BU')" />
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>BU Dev</b>
                                <div ng-click="sortColumn('profile', 'AWS Resp (Dev) BU')" ng-class="sortClass('profile', 'AWS Resp (Dev) BU')" />
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>Division</b>
                                <div ng-click="sortColumn('profile', 'Division')" ng-class="sortClass('profile', 'Division')" />
                            </div>
                        </th>
                        <th class="tContents">
                            <div class="tHeaders inline">
                                <b>SD</b>
                                <div ng-click="sortColumn('profile', 'SD')" ng-class="sortClass('profile', 'SD')" />
                            </div>
                        </th>
                    </tr>
                </thead>
                
                <tbody>
                    <tr ng-repeat="deal in filteredDeals | orderBy: column : reverse | pagination: (currentPage - 1) * pageSize | limitTo: pageSize">
                        <td class="tContents"><a href="" ng-click="open(deal['ID'])">{{ deal['ID'] }}</a></td>
                        
                        <td class="tContents">{{deal.profile['Client']}}</td>
                        <td class="tContents">{{deal.essential['Deal Name']}}</td>
                        <td class="tContents" style="text-align:right">{{deal.profile['Level']}}</td>
                        <td class="tContents">{{deal.profile['Step Description'] !== undefined ? deal.profile['Step Description'] : getStepJA(deal.profile['Step'])}}</td>
                        <td class="tContents">{{deal.profile['Type'].toUpperCase()}}</td>
                        <td class="tContents">{{deal.profile['AWS Resp (Sales) person']}}</td>
                        <td class="tContents">{{deal.profile['AWS Resp (Dev) person']}}</td>
                        <td class="tContents">{{formatDate(deal.profile['Duration (Start)'])}}</td>
                        <td class="tContents">{{formatDate(deal.profile['Duration (End)'])}}</td>
                        <td class="tContents">{{formatDate(deal.essential['Due Date'])}}</td>
                        
                        <!-- Columns for display -->
                        <td class="tContents" style="text-align:right" ng-repeat="month in generateMonths(startDate, endDate) | filter as resMonths">{{ getDistValue(deal, month, 'res', 'ph').toLocaleString('en', {useGrouping: true}) }}</td>
                        <td class="tContents" style="text-align:right">{{ calculateTotal(deal, resMonths, 'res', 'ph').toLocaleString('en', {useGrouping: true}) }}</td>
                        <td class="tContents" style="text-align:right" ng-repeat="month in generateMonths(startDate, endDate) | filter as revMonths">{{ getDistValue(deal, month, 'rev', 'ph').toLocaleString('en', {useGrouping: true, style: 'currency', currency: 'JPY'}) }}</td>
                        <td class="tContents" style="text-align:right">{{ calculateTotal(deal, revMonths, 'rev', 'ph').toLocaleString('en', {useGrouping: true, style: 'currency', currency: 'JPY'}) }}</td>
                        <td class="tContents" style="text-align:right" ng-repeat="month in generateMonths(startDate, endDate)  | filter as cmMonths">{{ getDistValue(deal, month, 'cm', 'jp').toLocaleString('en', {useGrouping: true, style: 'currency', currency: 'JPY'}) }}</td>
                        <td class="tContents" style="text-align:right">{{ calculateTotal(deal, cmMonths, 'cm', 'jp').toLocaleString('en', {useGrouping: true, style: 'currency', currency: 'JPY'}) }}</td>

                        <td class="tContents">{{deal.profile['AWS Resp (Sales) BU']}}</td>
                        <td class="tContents">{{deal.profile['AWS Resp (Dev) BU']}}</td>
                        <td class="tContents">{{deal.profile['Division']}}</td>
                        <td class="tContents">{{deal.profile['SD']}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- /*
* START Francis Nash Jasmin 2022/04/29
* Added page numbers below table
*/ -->
<div class="row">
    <div class="col-md-4"></div>
    <div class="col-md-4">
        <ul class="pagination" uib-pagination total-items="deals.length" ng-model="currentPage" items-per-page="pageSize" boundary-links="true"
        max-size="3" force-ellipses="true" first-text="<<" previous-text="<" next-text=">" last-text=">>"></ul>
    </div>
    <div class="col-md-4"></div>
</div>
<!-- /*  END Francis Nash Jasmin 2022/05/02 */ -->
